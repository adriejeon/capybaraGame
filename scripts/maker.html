<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´í”¼ë°”ë¼ í‹€ë¦°ê·¸ë¦¼ì°¾ê¸° ë ˆë²¨ ë©”ì´ì»¤</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
        .container { display: flex; gap: 20px; margin-top: 20px; }
        .canvas-wrapper { position: relative; }
        canvas { border: 2px solid #333; cursor: crosshair; background: white; }
        .sidebar { width: 350px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); height: fit-content; }
        textarea { width: 100%; height: 300px; margin-top: 10px; font-family: monospace; font-size: 12px; }
        button { padding: 8px 16px; cursor: pointer; background: #4CAF50; color: white; border: none; border-radius: 4px; font-size: 14px; }
        button:hover { background: #45a049; }
        button.delete-btn { background: #ff4444; margin-left: 5px; padding: 2px 6px; font-size: 12px; }
        .spot-item { background: #f9f9f9; border: 1px solid #ddd; padding: 5px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }
        h3 { margin-top: 0; }
    </style>
</head>
<body>

    <h2>ğŸ› ï¸ ì¹´í”¼ë°”ë¼ ë ˆë²¨ ë©”ì´ì»¤</h2>
    <p>í‹€ë¦° ê·¸ë¦¼ íŒŒì¼ì„ ì„ íƒí•˜ê³ , <b>í‹€ë¦° ë¶€ë¶„ì— ë§ˆìš°ìŠ¤ë¡œ ë°•ìŠ¤ë¥¼ ê·¸ë¦¬ì„¸ìš”.</b> JSONì´ ìë™ ìƒì„±ë©ë‹ˆë‹¤.</p>

    <div style="margin-bottom: 10px;">
        <label>1. í‹€ë¦° ê·¸ë¦¼ íŒŒì¼ ì„ íƒ: <input type="file" id="imgLoader" accept="image/*"></label>
    </div>

    <div class="container">
        <div class="canvas-wrapper">
            <canvas id="gameCanvas"></canvas>
        </div>

        <div class="sidebar">
            <h3>ë°ì´í„° (JSON)</h3>
            <div id="spotList" style="max-height: 200px; overflow-y: auto; margin-bottom: 10px;"></div>
            <button onclick="copyJson()">JSON ë³µì‚¬í•˜ê¸°</button>
            <button onclick="clearAll()" style="background:#666;">ì „ì²´ ì´ˆê¸°í™”</button>
            <textarea id="jsonOutput" readonly></textarea>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const imgLoader = document.getElementById('imgLoader');
        const jsonOutput = document.getElementById('jsonOutput');
        const spotList = document.getElementById('spotList');

        let img = new Image();
        let spots = [];
        let isDrawing = false;
        let startX, startY;
        let imgName = "";

        // ì´ë¯¸ì§€ ë¡œë“œ
        imgLoader.addEventListener('change', function(e){
            const reader = new FileReader();
            reader.onload = function(event){
                img.onload = function(){
                    canvas.width = img.width;
                    canvas.height = img.height;
                    imgName = e.target.files[0].name;
                    draw();
                }
                img.src = event.target.result;
            }
            reader.readAsDataURL(e.target.files[0]);
        });

        // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ (ë°•ìŠ¤ ê·¸ë¦¬ê¸°)
        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;
            isDrawing = true;
        });

        canvas.addEventListener('mousemove', (e) => {
            if(!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;
            
            draw(); // ê¸°ì¡´ ê·¸ë¦¼ ë³µêµ¬
            
            // ê·¸ë¦¬ëŠ” ì¤‘ì¸ ë¹¨ê°„ ë°•ìŠ¤ í‘œì‹œ
            ctx.strokeStyle = "red";
            ctx.lineWidth = 2;
            ctx.strokeRect(startX, startY, currentX - startX, currentY - startY);
        });

        canvas.addEventListener('mouseup', (e) => {
            if(!isDrawing) return;
            isDrawing = false;
            
            const rect = canvas.getBoundingClientRect();
            let endX = e.clientX - rect.left;
            let endY = e.clientY - rect.top;

            // ë„ˆë¹„, ë†’ì´ ê³„ì‚° (ìŒìˆ˜ ì²˜ë¦¬)
            let width = Math.abs(endX - startX);
            let height = Math.abs(endY - startY);
            let x = Math.min(startX, endX);
            let y = Math.min(startY, endY);

            // ë„ˆë¬´ ì‘ì€ ë°•ìŠ¤ ë¬´ì‹œ (ì‹¤ìˆ˜ ë°©ì§€)
            if(width < 10 || height < 10) return;

            addSpot(x, y, width, height);
            draw();
        });

        function addSpot(x, y, w, h) {
            const id = spots.length + 1;
            const centerX = x + w / 2;
            const centerY = y + h / 2;
            
            // ì•± í¬ë§·ì— ë§ëŠ” ë°ì´í„° ìƒì„±
            const spot = {
                id: id,
                x: Math.round(x),
                y: Math.round(y),
                width: Math.round(w),
                height: Math.round(h),
                center_x: Math.round(centerX),
                center_y: Math.round(centerY),
                // ì†Œìˆ˜ì  4ìë¦¬ê¹Œì§€ ë¹„ìœ¨ ê³„ì‚°
                relative_x: Number((centerX / canvas.width).toFixed(4)),
                relative_y: Number((centerY / canvas.height).toFixed(4)),
                relative_radius: Number((Math.max(w, h) / 2 / canvas.width).toFixed(4))
            };

            spots.push(spot);
            updateUI();
        }

        function removeSpot(index) {
            spots.splice(index, 1);
            // ID ì¬ì •ë ¬
            spots.forEach((s, i) => s.id = i + 1);
            draw();
            updateUI();
        }

        function clearAll() {
            if(confirm("ëª¨ë“  ë°•ìŠ¤ë¥¼ ì§€ìš°ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                spots = [];
                draw();
                updateUI();
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if(img.src) ctx.drawImage(img, 0, 0);

            // ì €ì¥ëœ ëª¨ë“  ë°•ìŠ¤ ê·¸ë¦¬ê¸°
            spots.forEach(spot => {
                ctx.strokeStyle = "#00FF00"; // ì™„ë£Œëœê±´ ì´ˆë¡ìƒ‰
                ctx.lineWidth = 3;
                ctx.strokeRect(spot.x, spot.y, spot.width, spot.height);
                
                // ë²ˆí˜¸ í‘œì‹œ
                ctx.fillStyle = "white";
                ctx.font = "bold 20px Arial";
                ctx.fillText(spot.id, spot.x, spot.y - 5);
                ctx.strokeStyle = "black";
                ctx.lineWidth = 1;
                ctx.strokeText(spot.id, spot.x, spot.y - 5);
            });
        }

        function updateUI() {
            // JSON ì—…ë°ì´íŠ¸
            jsonOutput.value = JSON.stringify(spots, null, 2);
            
            // ë¦¬ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            spotList.innerHTML = "";
            spots.forEach((spot, index) => {
                const div = document.createElement("div");
                div.className = "spot-item";
                div.innerHTML = `
                    <span>#${spot.id} (w:${spot.width}, h:${spot.height})</span>
                    <button class="delete-btn" onclick="removeSpot(${index})">X</button>
                `;
                spotList.appendChild(div);
            });
        }

        function copyJson() {
            jsonOutput.select();
            document.execCommand('copy');
            alert("JSON ë°ì´í„°ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ì•± ìì‚° íŒŒì¼ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.");
        }
    </script>
</body>
</html>

